library(stats)
options(digits = 6)
d<-function(v,beta,mu,N) {
  for (i in 1:10000){
    x<-v-i*0.0001
    ll<-function(delta)
    {(((delta^2/(1/(1+exp(-x))^2*(1-1/(1+exp(-x)))^2)+(1-2*1/(1+exp(-x)))^2*delta^4/(4*1/(1+exp(-x))^4*(1-1/(1+exp(-x)))^4)+(1-2*1/(1+exp(-x)))*delta^3/(1/(1+exp(-x))^3*(1-1/(1+exp(-x)))^3))/((delta^2/(1/(1+exp(-x))*(1-1/(1+exp(-x))))+1)^(N/2)-1)))}
    f<-optimize(ll,interval = c(0.0001,0.3),maximum=TRUE)
    delta<-f[[1]]
    m<-matrix(0,2,2)
    m[1,1]<-(beta^2*((((delta^2/(1/(1+exp(-x))^2*(1-1/(1+exp(-x)))^2)+(1-2*1/(1+exp(-x)))^2*delta^4/(4*1/(1+exp(-x))^4*(1-1/(1+exp(-x)))^4)+(1-2*1/(1+exp(-x)))*delta^3/(1/(1+exp(-x))^3*(1-1/(1+exp(-x)))^3))/((delta^2/(1/(1+exp(-x))*(1-1/(1+exp(-x))))+1)^(N/2)-1))^(-1))))+(beta^2*((((delta^2/(1/(1+exp(x))^2*(1-1/(1+exp(x)))^2)+(1-2*1/(1+exp(x)))^2*delta^4/(4*1/(1+exp(x))^4*(1-1/(1+exp(x)))^4)+(1-2*1/(1+exp(x)))*(-delta)^3/(1/(1+exp(x))^3*(1-1/(1+exp(x)))^3))/((delta^2/(1/(1+exp(x))*(1-1/(1+exp(x))))+1)^(N/2)-1))^(-1))))
    
    m[1,2]<-(-beta*((x-mu)*(((delta^2/(1/(1+exp(-x))^2*(1-1/(1+exp(-x)))^2)+(1-2*1/(1+exp(-x)))^2*delta^4/(4*1/(1+exp(-x))^4*(1-1/(1+exp(-x)))^4)+(1-2*1/(1+exp(-x)))*delta^3/(1/(1+exp(-x))^3*(1-1/(1+exp(-x)))^3))/((delta^2/(1/(1+exp(-x))*(1-1/(1+exp(-x))))+1)^(N/2)-1)))^(-1)))+(-beta*((-x-mu)*(((delta^2/(1/(1+exp(x))^2*(1-1/(1+exp(x)))^2)+(1-2*1/(1+exp(x)))^2*delta^4/(4*1/(1+exp(x))^4*(1-1/(1+exp(x)))^4)+(1-2*1/(1+exp(x)))*(-delta)^3/(1/(1+exp(x))^3*(1-1/(1+exp(x)))^3))/((delta^2/(1/(1+exp(x))*(1-1/(1+exp(x))))+1)^(N/2)-1)))^(-1)))
    
    m[2,1]<-m[1,2]
    
    m[2,2]<-(((x-mu)^2*(((delta^2/(1/(1+exp(-x))^2*(1-1/(1+exp(-x)))^2)+(1-2*1/(1+exp(-x)))^2*delta^4/(4*1/(1+exp(-x))^4*(1-1/(1+exp(-x)))^4)+(1-2*1/(1+exp(-x)))*delta^3/(1/(1+exp(-x))^3*(1-1/(1+exp(-x)))^3))/((delta^2/(1/(1+exp(-x))*(1-1/(1+exp(-x))))+1)^(N/2)-1)))^(-1)))+(((-x-mu)^2*(((delta^2/(1/(1+exp(x))^2*(1-1/(1+exp(x)))^2)+(1-2*1/(1+exp(x)))^2*delta^4/(4*1/(1+exp(x))^4*(1-1/(1+exp(x)))^4)+(1-2*1/(1+exp(x)))*(-delta^3)/(1/(1+exp(x))^3*(1-1/(1+exp(-x)))^3))/((delta^2/(1/(1+exp(x))*(1-1/(1+exp(x))))+1)^(N/2)-1)))^(-1)))
    
    r<- solve(m)
    
    chek<-function(t){
    2*(  r[1,1]*(beta^2*((((delta^2/(1/(1+exp(-t))^2*(1-1/(1+exp(-t)))^2)+(1-2*1/(1+exp(-t)))^2*delta^4/(4*1/(1+exp(-t))^4*(1-1/(1+exp(-t)))^4)+(1-2*1/(1+exp(-t)))*(delta^3)/(1/(1+exp(-t))^3*(1-1/(1+exp(-t)))^3))/((delta^2/(1/(1+exp(-t))*(1-1/(1+exp(-t))))+1)^(N/2)-1))^(-1))))+2*r[1,2]*(-beta*((t-mu)*(((delta^2/(1/(1+exp(-t))^2*(1-1/(1+exp(-t)))^2)+(1-2*1/(1+exp(-t)))^2*delta^4/(4*1/(1+exp(-t))^4*(1-1/(1+exp(-t)))^4)+(1-2*1/(1+exp(-t)))*delta^3/(1/(1+exp(-t))^3*(1-1/(1+exp(-t)))^3))/((delta^2/(1/(1+exp(-t))*(1-1/(1+exp(-t))))+1)^(N/2)-1)))^(-1)))+r[2,2]*(((t-mu)^2*(((delta^2/(1/(1+exp(-t))^2*(1-1/(1+exp(-t)))^2)+(1-2*1/(1+exp(-t)))^2*delta^4/(4*1/(1+exp(-t))^4*(1-1/(1+exp(-t)))^4)+(1-2*1/(1+exp(-t)))*delta^3/(1/(1+exp(-t))^3*(1-1/(1+exp(-t)))^3))/((delta^2/(1/(1+exp(-t))*(1-1/(1+exp(-t))))+1)^(N/2)-1)))^(-1)))-1
    
    )
          }
    dd<-optimize(chek,interval = c(-3,-0.0001),maximum=TRUE)
    print(x )
    print((dd[[2]])+500*dd[[2]]^2)
    
    print("****************************")
    if ((dd[[2]])+5000*dd[[2]]^2<0.000000001)
    {break
    }
  }
  plot(chek,-3,0)
  
  print(i)
  print("x=")
  print(x)
  print("delta=")
  print(delta)
  print(dd[2])
  #print(m)
}
d(-1,1,0,120) 

